(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{512:function(e,a,t){e.exports=t.p+"assets/img/1.af088f91.png"},513:function(e,a,t){e.exports=t.p+"assets/img/2.65b18f72.png"},514:function(e,a,t){e.exports=t.p+"assets/img/3.2f519d91.png"},515:function(e,a,t){e.exports=t.p+"assets/img/4.64957b9f.png"},516:function(e,a,t){e.exports=t.p+"assets/img/5.105868e4.png"},517:function(e,a,t){e.exports=t.p+"assets/img/6.c07d5a92.png"},518:function(e,a,t){e.exports=t.p+"assets/img/7.eea72fb4.png"},519:function(e,a,t){e.exports=t.p+"assets/img/8.1cded541.png"},520:function(e,a){e.exports="data:image/png;base64,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"},521:function(e,a,t){e.exports=t.p+"assets/img/10.f772c77f.png"},522:function(e,a,t){e.exports=t.p+"assets/img/11.e69a2c0a.png"},523:function(e,a,t){e.exports=t.p+"assets/img/12.994e2d2a.png"},524:function(e,a,t){e.exports=t.p+"assets/img/13.6c53e32d.png"},562:function(e,a,t){"use strict";t.r(a);var s=t(6),n=Object(s.a)({},(function(){var e=this,a=e.$createElement,s=e._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h2",{attrs:{id:"_0x01"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_0x01"}},[e._v("#")]),e._v(" 0x01")]),e._v(" "),s("p",[e._v("最近打算对一个旧网站进行翻新重写，为了参考以前的架构，将线上的数据库复制一份到本地")]),e._v(" "),s("p",[e._v("一般迁移数据库都是这几个常见方法")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("1.用mysqldump导出sql文件\n2.借助第三方软件\n3.直接拷贝数据库文件(需要改权限和确保数据库引擎一致)\n")])])]),s("p",[e._v("我选用的是第一项(用的比较多")]),e._v(" "),s("p",[e._v("执行")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("docker exec 容器id /usr/bin/mysqldump -u root --password=root 数据库名称 > backup.sql\n")])])]),s("p",[s("img",{attrs:{src:t(512),alt:""}})]),e._v(" "),s("p",[e._v("得到了backup.sql文件，将其拷贝回本地")]),e._v(" "),s("p",[e._v("然后在本地导入到容器，新建数据库\n"),s("img",{attrs:{src:t(513),alt:""}})]),e._v(" "),s("p",[e._v("导入")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("cat backup.sql | docker exec -i 容器id /usr/bin/mysql -u root --password=root 数据库名称\n")])])]),s("p",[e._v("但几秒钟后，失败\n"),s("img",{attrs:{src:t(514),alt:""}})]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("ERROR 1813 (HY000) at line 104: Tablespace for table '``.`logs`' exists. Please DISCARD the tablespace before IMPORT\n")])])]),s("h2",{attrs:{id:"_0x02"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_0x02"}},[e._v("#")]),e._v(" 0x02")]),e._v(" "),s("p",[e._v("我们详细执行看看\n先将sql文件拷贝到容器内部")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("docker cp backup.sql cba:/\n")])])]),s("p",[s("img",{attrs:{src:t(515),alt:""}}),e._v(" "),s("img",{attrs:{src:t(516),alt:""}}),e._v(" "),s("img",{attrs:{src:t(517),alt:""}})]),e._v(" "),s("p",[e._v("看一下sql文件位置\n"),s("img",{attrs:{src:t(518),alt:""}})]),e._v(" "),s("p",[s("img",{attrs:{src:t(519),alt:""}})]),e._v(" "),s("p",[e._v("这两个表的名字很相似，只有开头不一样，一个是Logs，一个是logs\n但在服务器上是完整的存在")]),e._v(" "),s("p",[s("img",{attrs:{src:t(520),alt:""}})]),e._v(" "),s("p",[e._v("并不像网上所查到的文件缺失\n"),s("img",{attrs:{src:t(521),alt:""}})]),e._v(" "),s("p",[e._v("查看大小写是否敏感")]),e._v(" "),s("p",[e._v("本地:")]),e._v(" "),s("p",[s("img",{attrs:{src:t(522),alt:""}})]),e._v(" "),s("p",[e._v("server:\n"),s("img",{attrs:{src:t(523),alt:""}})]),e._v(" "),s("p",[e._v("两边均开启")]),e._v(" "),s("h2",{attrs:{id:"_0x03"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_0x03"}},[e._v("#")]),e._v(" 0x03")]),e._v(" "),s("p",[e._v("后面想是不是mariadb更新问题，毕竟线上跑的是半年前和朋友一起迁移，于是google了一下，大概知道了什么问题")]),e._v(" "),s("p",[s("a",{attrs:{href:"https://mariadb.com/kb/en/identifier-case-sensitivity/",target:"_blank",rel:"noopener noreferrer"}},[e._v("链接"),s("OutboundLink")],1)]),e._v(" "),s("p",[s("img",{attrs:{src:t(524),alt:""}})]),e._v(" "),s("p",[e._v("docker mariadb的数据是要永久存储，因此是用挂载的方式，尽管容器内是linux，但似乎依然收到宿主机的磁盘格式影响")]),e._v(" "),s("h2",{attrs:{id:"_0x04"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_0x04"}},[e._v("#")]),e._v(" 0x04")]),e._v(" "),s("p",[e._v("于是建个linux虚拟机验证一下\n把容器跑起来")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('$ sudo docker-compose up -d\nCreating network "switch" with driver "bridge"\nPulling mariadb (mariadb:)...\nlatest: Pulling from library/mariadb\n5bed26d33875: Pull complete\nf11b29a9c730: Pull complete\n930bda195c84: Pull complete\n78bf9a5ad49e: Pull complete\ne9e3c043ec68: Pull complete\n141e45c6af4b: Pull complete\na26245908a82: Pull complete\n40ccaf895c8a: Pull complete\n2d665f60c94a: Pull complete\nc7bcd9961bee: Pull complete\n80f1ddb594ce: Pull complete\n0647ec428f9f: Pull complete\n9cb6e30e72ca: Pull complete\n60890c0035d8: Pull complete\nDigest: sha256:d0e2c681c41e91aba6e9c8c0a588eedd48291a70464e83c40da2e3de01998eef\nStatus: Downloaded newer image for mariadb:latest\nCreating mariadb ... done\n\n$ sudo docker ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED              STATUS              PORTS                    NAMES\nc733c7e33571        mariadb             "docker-entrypoint.s…"   About a minute ago   Up About a minute   0.0.0.0:3306->3306/tcp   mariadb\n')])])]),s("p",[e._v("创建数据库")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("$ sudo docker exec -it c73 bash\nroot@c733c7e33571:/# mysql -u root -p\nEnter password:\nWelcome to the MariaDB monitor.  Commands end with ; or \\g.\nYour MariaDB connection id is 8\nServer version: 10.4.12-MariaDB-1:10.4.12+maria~bionic mariadb.org binary distribution\n\nCopyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.\n\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nMariaDB [(none)]> create database test;\nQuery OK, 1 row affected (0.000 sec)\n")])])]),s("p",[e._v("导入")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("$ sudo docker cp org.sql c73:/\n\n$ sudo docker exec -it c73 bash\nroot@c733c7e33571:/# ls\nbin  boot  dev  docker-entrypoint-initdb.d  docker-entrypoint.sh  etc  home  lib  lib64  media  mnt  opt  org.sql  proc  root  run  sbin  srv  sys  tmp  usr  var\nroot@c733c7e33571:/# mysql -u root -p test < org.sql\nEnter password:\nroot@c733c7e33571:/#\n")])])]),s("p",[e._v("验证")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("root@c733c7e33571:/# mysql -u root -p\nEnter password:\nWelcome to the MariaDB monitor.  Commands end with ; or \\g.\nYour MariaDB connection id is 11\nServer version: 10.4.12-MariaDB-1:10.4.12+maria~bionic mariadb.org binary distribution\n\nCopyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.\n\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nMariaDB [(none)]> show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| mysql              |\n| performance_schema |\n| test               |\n+--------------------+\n4 rows in set (0.001 sec)\n\nMariaDB [(none)]> use test\nReading table information for completion of table and column names\nYou can turn off this feature to get a quicker startup with -A\n\nDatabase changed\nMariaDB [test]> show tables;\n+--------------------------+\n| Tables_in_test           |\n+--------------------------+\n| Logs                     |\n| --------------           |\n| ----                     |\n| logs                     |\n| ----------------         |\n| ------------------------ |\n| -----                    |\n+--------------------------+\n7 rows in set (0.000 sec)\n\nMariaDB [test]>\n")])])]),s("p",[e._v("可以看到在linux上正常，确实是mac的磁盘格式影响")]),e._v(" "),s("p",[e._v("官方所说的ufs格式就不进行测试了")]),e._v(" "),s("p",[e._v("最后附上我的docker mariadb compose文件")]),e._v(" "),s("p",[e._v("docker-compose.yml")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('# Use root/example as user/password credentials\nversion: "3.7"\n\nservices:\n  mariadb:\n    image: mariadb\n    restart: always\n    container_name: mariadb\n    environment:\n      MYSQL_ROOT_PASSWORD: password\n    volumes:\n      - ./mariadb/data:/var/lib/mysql\n      - ./mariadb/config:/etc/mysql/conf.d\n      - ./binlog.cnf:/etc/mysql/conf.d/binlog.cnf\n    ports:\n      - "3306:3306"\n    networks:\n       switch:\n           aliases: \n                - mariadb\n\nnetworks:\n  switch:\n    name: switch\n    driver: bridge\n')])])]),s("p",[e._v("binlog.cnf")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("[mysqld]\ncharacter-set-server=utf8\nlog_bin=/var/lib/mysql/bin-log\nlog_bin_index=/var/lib/mysql/mysql-bin.index\nexpire_logs_days=7\nserver_id=0002\nbinlog_format=ROW\nwait_timeout=31536000\ninteractive_timeout=31536000\n[client]\ndefault-character-set=utf8\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);